webpackJsonp([2],{25:function(t,e,n){"use strict";(function(t){function e(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(){ajax(Api("getCompanyInfo")).then(function(e){console.info(e);var n="";if(e){var a=e.data;n='<li class="list-group-item"><span>公司名称：</span><em>'+a.name+'</em></li><li class="list-group-item"><span>公司地址：</span><em>'+a.addr+'</em></li><li class="list-group-item"><span>公司主体：</span><em>'+a.ownerid+"</em></li>";for(var i="",o=0;o<a.mp.minipro.length;o++){var r=a.mp.minipro[o];i+='\n                    <li class="list-group-item clearfix">\n                        <span class="fl"> '+r.vname+'：</span>\n                        <div class="fl minipro-list">\n                            <i class="iconfont icon-xiaochengxu i-selected"></i> \n                            '+r.path+' \n                        </div>\n                        <div class="fr">\n                            <button id="bind-minipro" data-order="'+r.url+'" type="button" class="btn btn-primary" data-target="#myModal">绑定小程序</button>\n                        </div>\n                </li>\n                    '}n+=i;for(var d="",s=0;s<a.mp.fwh.length;s++){var c=a.mp.fwh[s];d+='\n                    <li class="list-group-item clearfix">\n                        <span class="fl"> '+c.vname+'：</span>\n                        <div class="fl minipro-list">\n                            <i class="iconfont icon-wechat i-selected"></i> \n                            '+c.path+' \n                        </div>\n                        <div class="fr">\n                            <button id="bind-minipro" data-order="'+c.url+'" type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">绑定服务号</button>\n                        </div>\n                </li>\n                    '}n+=d,n+='\n                <li class="list-group-item">\n                    <span>是否冻结：</span>\n                    <em>'+a.is_frozen+'</em>\n                </li>\n                <li class="list-group-item">\n                    <span>加入时间：</span>\n                    <em>'+a.intime+'</em>\n                </li>\n                <li class="list-group-item">\n                    <span>更新时间：</span>\n                    <em>'+a.uptime+'</em>\n                </li>\n                <li class="list-group-item">\n                    <span>联系方式：</span>\n                    <em>'+a.contact+"</em>\n                </li>\n            "}else n="<p>暂无数据！</p>";var l=t(".list-company");l.empty(),l.append(n)})}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}();n(10),n(11);var r=n(13),d=e(r),s=n(12),c=e(s);n(45);n(14),n(5);document.cookie="PHPSESSID=lcto08vongb772jcorhugg3vb5",c.default.getCookie(),window.addEventListener("message",function(t){console.log("from iframe....")},!1),t(document).ready(function(){function e(){var e="";ajax(Api("getEmpList")).then(function(n){console.log(n);var a=n.data,i=a.length;if(y=a,i>0){e+="<thead>< tr > <th>员工姓名</th> <th>员工类型</th> <th>联系方式</th> <th>更新时间</th> <th>加入时间</th>  <th>操作</th> </tr > </thead ><tbody>";for(var o=0;o<i;o++){var r=a[o];e+="\n                        <tr>\n                            <td>"+r.name+"</td>\n                            <td>"+r.usertype+"</td>\n                            <td>"+r.uptime+"</td>\n                            <td>"+r.intime+"</td>\n                            <td>"+r.contact+' </td>\n                            <td> \n                                <input type="hidden" value="'+r.id+'">\n                                <button class="btn btn-warning" id="employee-edit-btn">编辑</button>\n                                <button class="btn btn-danger" id="employee-delet-btn">删除</button>\n                            </td>\n                        </tr>\n                        '}e+="</tbody>"}else e="<p>暂无数据！</p>";var d=t(".employee-table");d.empty(),d.append(e)})}function n(e,n){var a=t(this).parent().children("input").val(),i=function(){ajax(Api(e,{empid:a})).then(function(t){console.log(t),200===t.code?(d.default.myLayer("删除成功！",1),n()):d.default.myLayer("删除失败！",5)})};return d.default.myLayerTips("是否删除所选！",i)}function r(e){function n(e){var n=new BMap.Geocoder,i=e.point;n.getLocation(i,function(e){var n=e.addressComponents;console.log(n);var o="";o=!n.streetNumber&&e.surroundingPois.length>0?n.street?n.street+e.surroundingPois[0].title:e.surroundingPois[0].title:n.streetNumber||0!==e.surroundingPois.length?n.street+n.streetNumber:"";n.province,n.city,n.district;t("#addr_detail").val(o),n.province===n.city?(t("#input_province").val(n.province),t("#input_province").trigger("change"),t("#input_city").val(n.district),t("#input_city").trigger("change")):(t("#input_province").val(n.province),t("#input_province").trigger("change"),t("#input_city").val(n.city),t("#input_city").trigger("change"),t("#input_area").val(n.district)),a.clearOverlays(),a.centerAndZoom(i,20);var r=new BMap.Marker(i);a.addOverlay(r);var d=function(e,n,i){a.removeOverlay(i),t("#addr_detail").val("")},s=new BMap.ContextMenu;s.addItem(new BMap.MenuItem("删除",d.bind(r))),r.addContextMenu(s)})}var a=new BMap.Map("store-map");if(a.enableScrollWheelZoom(),a.enableContinuousZoom(),e){var i=e.input_province+e.input_city+e.input_area;a.setCenter(i),a.centerAndZoom(i,12)}else{(new BMap.Geolocation).getCurrentPosition(function(t){this.getStatus()==BMAP_STATUS_SUCCESS?(a.setCenter(t.address.city),a.centerAndZoom(t.address.city,12)):alert("failed获取定位失败！")})}var o="",r="",d="";t("#input_province").change(function(t){o=t.target.value,a.centerAndZoom(o,12),a.clearOverlays()}),t("#input_city").change(function(t){r=t.target.value,a.centerAndZoom(o+r,12),a.clearOverlays()}),t("#input_area").change(function(t){d=t.target.value,a.centerAndZoom(o+r+d,13),a.clearOverlays()}),a.addEventListener("click",n)}function s(){var e=layer.load(0);ajax(Api("getCustomerList")).then(function(a){if(console.log(a.data),a.data){layer.close(e);var i=a.data,o=i.length;z=i;var r="";if(o>0){r+="<thead>< tr > <th>客户姓名</th> <th>微信</th> <th>微信电话</th><th>联系方式</th><th>绑定电话</th><th>密码</th> <th>更新时间</th> <th>加入时间</th>  <th>操作</th> </tr > </thead ><tbody>";for(var d=0;d<o;d++){var c=i[d];r+="\n                        <tr>\n                            <td>"+c.name+"</td>\n                            <td>"+c.wxuid+"</td>\n                            <td>"+c.wxphone+"</td>\n                            <td>"+c.contact+"</td>\n                            <td>"+c.bind_phone+"</td>\n                            <td>"+c.pass+"</td>\n                            <td>"+c.uptime+"</td>\n                            <td>"+c.intime+'</td>\n                            <td> \n                                <input type="hidden" value="'+c.id+'">\n                                <button class="btn btn-warning" id="customer-edit-btn">编辑</button>\n                            </td>\n                        </tr>\n                        '}r+="</tbody>"}else r="<p>暂无数据！</p>";var l=t(".customer-table");l.empty(),l.append(r),v.on("click","#customer-delet-btn",function(){n("deletStore",s)}),v.on("click","#customer-edit-btn",m)}})}function c(){t(this).hide(),t(".off-customer").show(),t(".customer-table").hide(),t(".customer-form").show()}function l(){P=!1,t(this).hide(),t(".add-customer").show(),t(".customer-table").show(),t(".customer-form").hide()}function p(){var e=t(".customer-form").serializeArray(),n={},a="addCustomer",i="添加成功！";P&&(a="updateCustomer",i="更新成功！",n.customerid=e.id);for(var o=0;o<e.length;o++){var r=e[o];n[r.name]=r.value}ajax(Api(a,n)).then(function(e){e?(d.default.myLayer(i,1),t(".off-customer").trigger("click"),s()):d.default.myLayer("操作失败！",5)})}function m(){P=!0,t(".add-customer").trigger("click");for(var e=t(this).parent().children("input").val(),n={},a=0;a<z.length;a++){var i=z[a];if(e==i.id){n=Object.assign({},i);break}}var o=t(".customer-form");o.find('input[name="id"]').val(e),o.find('input[name="name"]').val(n.name),o.find('input[name="contact"]').val(n.contact),o.find('input[name="bind_phone"]').val(n.bind_phone)}var u=t(".employee"),h=t(".company"),f=t(".store"),v=t(".customer"),g={},y=[];i(),t(".nav-company").on("click",function(){i(),h.show(),u.hide(),f.hide(),v.hide(),t(".order").hide()}),t(".nav-company").trigger("click");var b=Object.assign({name:{message:"公司名称不能为空",validators:{notEmpty:{message:"公司名称不能为空"},stringLength:{min:2,max:30,message:"公司名称长度不能小于2位或超过30位"},regexp:{regexp:/^[A-Za-z0-9\u4e00-\u9fa5]+$/,message:"公司名称只能由字母、数字、点和下划线组成。"}}},contact:{validators:{notEmpty:{message:"手机号码不能为空！"},regexp:{regexp:/^1[35678]\d{9}$/,message:"手机号码格式不正确。"}}}},{}),k=Object.assign({message:"This value is not valid",excluded:":disabled",feedbackIcons:{valid:"iconfont icon-zhengque",invalid:"iconfont icon-cuowu",validating:"iconfont icon-cuowu"}},{fields:b});d.default.toggle(t("#edit"),t(".list-company"),t(".form-company"),k),h.on("click","#bind-minipro",function(e){var n=t(e.target).attr("data-order");ajax(null,n).then(function(e){if(e.data){t("#myModal-company").modal("show");var n='\n                    <div class="modal-body">\n                        <iframe src="'+e.data+'" frameborder="0" width="800px" height="400px;"></iframe>\n                    </div>\n                ';t("#myModal-company-inner").empty(),t("#myModal-company-inner").append(n)}})}),t("#company-submit").click(function(){var e=t(".form-company");if(e.bootstrapValidator("validate"),e.data("bootstrapValidator").isValid()){var n=e.serializeArray(),a={};n.forEach(function(t){a[t.name]=t.value}),ajax(Api("updateCompanyInfo",a)).then(function(n){e[0].reset(),i(),t("#edit").trigger("click"),t(".list-company").show(),e.hide()})}}),t(".nav-employee").on("click",function(){g.edit=!1,h.hide(),u.show(),f.hide(),e()}),u.on("click","#employee-edit-btn",function(){var e=t(this).parent().children("input").val();t(".edit-employee").trigger("click");for(var n={},a=0;a<y.length;a++){var i=y[a];if(e==i.id){n=Object.assign({},i);break}}var o=t(".employee-form");o.find('input[name="name"]').val(n.name),o.find('input[name="contact"]').val(n.contact),o.find('input[name="usertype"]').val(n.usertype),g.edit=!0}),u.on("click","#employee-delet-btn",function(){n("deletEmp",e)});var w={live:"disabled",excluded:[":disabled",":hidden",":not(:visible)"],feedbackIcons:{valid:"iconfont icon-zhengque",invalid:"iconfont icon-cuowu",validating:"iconfont icon-cuowu"},fields:{name:{validators:{notEmpty:{message:"姓名不能为空"},stringLength:{min:2,max:30,message:"姓名长度不能小于2位或超过30位"},regexp:{regexp:/^[A-Za-z\u4e00-\u9fa5]+$/,message:"姓名只能由字母和汉字组成。"}}},pass:{validators:{notEmpty:{message:"密码不能为空！"},stringLength:{min:6,max:30,message:"密码长度不能小于6位或超过30位"},regexp:{regexp:/^[a-zA-Z0-9_\.]+$/,message:"密码只能由字母、数字和下划线。"}}},employeePasswordTwo:{validators:{notEmpty:{message:"密码不能为空！"},stringLength:{min:6,max:30,message:"密码长度不能小于6位或超过30位"},regexp:{regexp:/^[a-zA-Z0-9_\.]+$/,message:"密码只能由字母、数字和下划线。"},identical:{field:"pass",message:"两次输入密码不匹配"}}},contact:{validators:{notEmpty:{message:"手机号码不能为空！"},regexp:{regexp:/^1[35678]\d{9}$/,message:"手机号码格式不正确。"}}}}};d.default.toggle(t(".edit-employee"),t(".employee-table"),t(".employee-form"),w,g,"添加");var x=t(".employee-form");t(".employee-btn-add").click(function(){if(console.log(g),x.bootstrapValidator("validate"),x.data("bootstrapValidator").isValid()){var n=x.serializeArray(),a={};n.forEach(function(t){"employeePasswordTwo"!==t.name&&(a[t.name]=t.value)});var i="addEmp";g.edit&&(i="updateEmp",a=Object.assign(a,{empid:2})),ajax(Api(i,a)).then(function(n){n?(x[0].reset(),e(),t(".edit-employee").trigger("click")):d.default.myLayer("请求失败！",5)})}});var _=function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a="",i=0;i<e.length;i++){var o=e[i];a+='<option value="'+o.id+'">'+o.name+"</option>"}var r=t("#select-store-id");r.empty(),r.append(a);var d={iconBase:"iconfont icon-jiantou",tickIcon:"iconfont icon-zhengque"};r.selectpicker(d),n&&r.selectpicker("val",n)},L=[],A=!1,M="",j=function(){ajax(Api("getStoreList")).then(function(e){if(e){console.log(e);var n=e.data;L=n;var a=n.length,i="";if(a>0){i+="<thead>< tr > <th>序号</th> <th>店名</th><th>操作员</th> <th>联系方式</th><th>地址</th>  <th>操作</th> </tr > </thead ><tbody>";for(var o=0;o<a;o++){var r=n[o];if(i+="\n                        <tr>\n                            <td>"+(o+1)+"</td>\n                            <td>"+r.name+"</td>\n                            <td>\n                        ",r.operator_ids)for(var d=r.operator_ids,s=0;s<d.length;s++){var c=d[s];i+="<p>"+c.name+"</p>"}i+="</td>\n                            <td>"+r.contact+" </td>\n                            <td>"+r.input_province+r.input_city+r.input_area+r.addr_detail+'</td>\n                            <td> \n                                <input type="hidden" value="'+r.id+'">\n                                <button class="btn btn-warning" id="store-edit-btn">编辑</button>\n                                <button class="btn btn-danger" id="store-delet-btn">删除</button>\n                            </td>\n                        </tr>\n                        '}i+="</tbody>"}else i="<p>暂无数据！</p>";var l=t(".store-table");l.empty(),l.append(i)}})},E=function(){f.show(),h.hide(),u.hide(),v.hide(),t(".order").hide(),j()},S=function(e,n){t(".store-table").hide(),t(".store-form").show(),t(".add-store").hide(),t(".off-store").show();t("#map-warp").empty(),t("#map-warp").append('\n            <div id="store-map" style="width:100%;height:300px;"></div>'),n?r(e):r(),ajax(Api("getEmpList")).then(function(t){t&&_(t.data,n)})},C=function(){A=!1,t(":input",t(".store-form")).not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected"),t(".store-table").show(),t(".store-form").hide(),t(".add-store").show(),t(".off-store").hide()};t(".nav-store").on("click",E),t(".add-store").on("click",S),t(".off-store").on("click",C),f.on("click","#store-delet-btn",function(){n("deletStore",j)}),f.on("click","#store-edit-btn",function(){A=!0,M=t(this).parent().children("input").val();for(var e={},n=0;n<L.length;n++){var a=L[n];if(M==a.id){e=Object.assign({},a);break}}var i=e.operator_ids.map(function(t){return t.id}),o=t(".store-form");o.find('input[name="name"]').val(e.name),o.find('input[name="contact"]').val(e.contact),o.find('input[name="input_province"]').val(e.input_province),o.find('input[name="input_city"]').val(e.input_city),o.find('input[name="input_area"]').val(e.input_area),o.find('input[name="addr_detail"]').val(e.addr_detail),S(e,i)});var O=function(){for(var e=t(".store-form").serializeArray(),n={},a=[],i="addStore",o=0;o<e.length;o++){var r=e[o];"select-store-all"===r.name?a.push(r.value):n[r.name]=r.value}n.operator_ids=a,A&&(n.storeid=M,i="gudateStore"),ajax(Api(i,n)).then(function(t){console.log(t),t&&(d.default.myLayer("添加成功！",1),C(),j())})};t(".store-btn-add").click(O);var z=[],P=!1;t(".nav-customer").on("click",function(){v.show(),f.hide(),h.hide(),u.hide(),t(".order").hide(),s()}),t(".add-customer").on("click",c),t(".off-customer").on("click",l),t(".customer-btn-add").on("click",p);var Z=function(){function e(t,n,i){a(this,e),this.tableList=t,this.tableMonth=n,this.tableWeek=i}return o(e,[{key:"getOrder",value:function(){this.showOrder()}},{key:"showOrder",value:function(){t(".order").show(),v.hide(),f.hide(),h.hide(),u.hide(),this.cancel()}}]),e}();Z.prototype.getDoctorList=function(){var t=this;ajax(Api("getEmpList")).then(function(e){var n="",a=e.data,i=a.length;if(t.doctorList=a,i>0){n+="<thead><tr> <th>序号</th><th>员工姓名</th><th>角色</th><th>排班</th> </tr > </thead><tbody>";for(var o=0;o<i;o++){var r=a[o];n+="\n                        <tr>\n                            <td>"+(o+1)+"</td>\n                            <td>"+r.name+"</td>\n                            <td>"+r.usertype+'</td>\n                            <td> \n                                <input type="hidden" value="'+r.id+'">\n                                <button class="btn btn-warning" id="order-week-btn">按周</button>\n                                <button class="btn btn-danger" id="order-month-btn">按月</button>\n                            </td>\n                        </tr>\n                        '}n+="</tbody>"}else n="<p>暂无数据！</p>";var d=t.tableList;d.empty(),d.append(n);var s=function(){t.selectList("week")},c=function(){t.selectList("month")};t.tableList.on("click","#order-week-btn",s),t.tableList.on("click","#order-month-btn",c)})},Z.prototype.getStoreList=function(){var e=this;return new Promise(function(n,a){ajax(Api("getStoreList")).then(function(a){var i="",o=a.data,r=o.length;if(e.storeList=o,r>0)for(var d=0;d<r;d++){var s=o[d];i+='\n                        <label class="checkbox-inline">\n                                <input name="checkStore" type="radio" value="'+s.id+'">'+s.name+"\n                            </label>\n                            "}else i="<p>暂无数据！</p>";var c=t(".order-week-inner-form");c.empty(),c.append(i),n(o)})})},Z.prototype.cancel=function(){function e(t){that.showModal(t)}this.tableList.show(),this.tableWeek.hide(),t(".save-order-time").unbind("click"),t(".cancel-order-time").unbind("click"),t(".order-week-modal-on").unbind("click"),t("#order-week").unbind("click",e)},Z.prototype.selectList=function(e){function n(){r.cancel()}function a(){for(var e=t(".order-week-table td"),n=[],a=0;a<e.length;a++){var i=e[a],o=t(i).children(".day"),r=t(i).children(".am").children(".content").attr("id"),d=t(i).children(".pm").children(".content").attr("id");if(r||d){var s={am:r||"",pm:d||""};s[o.attr("name")]=o.text(),n.push(s)}}console.log(n)}function i(t){r.showModal(t)}var o=this,r=this;this.tableList.hide(),this.tableWeek.show(),"week"===e?this.creatWeek():this.creatMonth(),t(".cancel-order-time").on("click",n),t(".save-order-time").on("click",a);this.getStoreList().then(function(t){o.tableWeek.on("click",".order-week-table td .content",i)}),t(".order-week-modal-on").on("click",function(){for(var e="",n=t(".order-week-inner-form").serializeArray()[0].value,a=0;a<r.storeList.length;a++){var i=r.storeList[a];if(n==i.id){e=i.name;break}}t("").empty(),t("").attr("id",""),t("").attr("id",n),t("").text(e)})},Z.prototype.showModal=function(e){if(ele=e.target,t(ele).html())return t(ele).empty(),t(ele).attr("id",""),!1;t("#myModal-order").modal("show")},Z.prototype.creatWeek=function(){for(var e="\n            <tr>\n                <th>周一</th>\n                <th>周二</th>\n                <th>周三</th>\n                <th>周四</th>\n                <th>周五</th>\n                <th>周六</th>\n                <th>周日</th>\n            </tr>\n            <tr>",n=[1,2,3,4,5,6,0],a=0;a<n.length;a++)e+='\n                <td>\n                    <em style="display:none;" name="week" class="day">'+n[a]+'</em>\n                    <span class="am">\n                        <span class="time">上午</span>\n                        <p class="content"></p>\n                    </span>\n                    <span class="pm">\n                        <span class="time">下午</span>\n                        <p class="content"></p>\n                    </span>\n                </td>\n                ';e+="\n            </tr>\n            ",t(".order-week-table").empty(),document.getElementsByClassName("order-week-table")[0].innerHTML=e},Z.prototype.creatMonth=function(){var e=" ",n=new Date,a=new Date(n.getTime()).getDay(),i=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],o=[],r=[];i.forEach(function(t,e){e>=a?o.push(t):r.push(t)}),e+="<tr>";for(var d=0;d<o.length;d++)e+="<th>"+o[d]+"</th>";for(var s=0;s<r.length;s++)e+="<th>"+r[s]+"</th>";e+="</tr>";for(var c=0;c<30;c++){var l=new Date(n.getTime()+864e5*c).toLocaleDateString();c%7==0&&(e+="</tr><tr>"),e+='\n                <td>\n                    <em name="day" class="day">'+l+'</em>\n                    <span class="am">\n                        <span class="time">上午</span>\n                        <p class="content"></p>\n                    </span>\n                    <span class="pm">\n                        <span class="time">下午</span>\n                        <p class="content"></p>\n                    </span>\n                </td>\n            ',29===c&&(e+="</tr>")}t(".order-week-table").empty(),document.getElementsByClassName("order-week-table")[0].innerHTML=e},t(".nav-order").on("click",function(){var e=new Z(t("#order-table"),t("#order-month"),t("#order-week"));e.getOrder(),e.getDoctorList()})})}).call(e,n(1))},45:function(t,e){}},[25]);